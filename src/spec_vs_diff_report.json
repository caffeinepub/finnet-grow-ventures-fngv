{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-15T05:05:32.301Z",
  "summary": "Frontend onboarding modal and React Query layer appear updated to use a conditional “Upline Associate ID Number” flow when a URL `ref` parameter is present, including client-side validation and error/success toasts. However, the diff summary does not provide evidence that the backend implements the required new registration entry point and referral-linking behavior; instead it shows an unrequested migration/schema change adding `referredByAssociateId` plus new migration files.",
  "missing_requirements": [
    {
      "id": "REQ-25",
      "requirement": "Add backend support to register a new associate using an upline associate ID number (Text) during referral-based onboarding: validate uplineAssociateId exists in associateIds, trap with an English error if not found, and when valid set referredBy and update referrals mapping; keep existing registerWithReferral(profile, referrerCode) behavior intact.",
      "reason": "The backend diff is truncated and does not show any new public method (e.g., `registerWithUplineId(profile, uplineAssociateId)`), nor code that validates the upline ID against `associateIds`, traps with an English error, sets `referredBy`, or updates the `referrals` map for `getDirectReferrals()`. The summary only shows type changes and added migration imports/files.",
      "evidence": [
        "backend/main.mo",
        "backend/migration.mo",
        "backend/migration/Validation.mo"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Added a data migration module and validation helper under `backend/migration*`, and wired migration into the main actor via `(with migration = Migration.run)`.",
      "reason": "BuildRequest does not request introducing migration infrastructure or new backend modules/files; it only requests adding a backend entry point and logic in `backend/main.mo` while keeping a single actor.",
      "evidence": [
        "backend/main.mo",
        "backend/migration.mo",
        "backend/migration/Validation.mo"
      ]
    },
    {
      "description": "Extended `UserProfile` with a new field `referredByAssociateId : ?Text` and populated it in the migration.",
      "reason": "BuildRequest only requires linking referrals by setting `referredBy` and updating referrals mappings; it does not request persisting the upline associate ID on the profile as a new field.",
      "evidence": [
        "backend/main.mo",
        "backend/migration.mo"
      ]
    }
  ],
  "confidence": 0.63,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "backend/migration/Validation.mo",
    "frontend-file-summaries.txt",
    "frontend/src/components/profile/ProfileSetupModal.tsx",
    "frontend/src/hooks/useQueries.ts",
    "project_state.json"
  ]
}